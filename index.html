<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-Powered Smart Educational Platform</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
  <style>
    :root {
      --bg: #0f2027;
      --bg-light: #1e2b35;
      --text: #ffffff;
      --primary: #00bcd4;
      --primary-dark: #0097a7;
      --accent: #ff4081;
      --accent-dark: #f50057;
      --success: #4caf50;
      --warning: #ff9800;
      --font: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      --radius: 8px;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 1rem;
      font-family: var(--font);
      background: linear-gradient(to right, var(--bg), #203a43, #2c5364);
      color: var(--text);
      max-width: 1200px;
      margin: auto;
      line-height: 1.6;
    }

    .preview-container {
      background: white;
      border-radius: var(--radius);
      margin-top: 1rem;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .preview-iframe {
      width: 100%;
      height: 400px;
      border: none;
      background: white;
    }

    .preview-header {
      background: var(--primary);
      color: white;
      padding: 0.5rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .language-tabs {
      display: flex;
      gap: 0.5rem;
    }

    .lang-tab {
      padding: 0.3rem 0.8rem;
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .lang-tab.active {
      background: white;
      color: var(--primary);
    }

    .output-tabs {
      display: flex;
      background: rgba(0, 0, 0, 0.3);
      border-radius: var(--radius);
      padding: 0.3rem;
      margin-bottom: 1rem;
    }

    .output-tab {
      padding: 0.5rem 1rem;
      cursor: pointer;
      border-radius: calc(var(--radius) - 2px);
      transition: all 0.3s ease;
      text-align: center;
      flex: 1;
    }

    .output-tab.active {
      background: var(--primary);
    }

    .python-output {
      background: #2b5b84;
      color: white;
      padding: 1rem;
      border-radius: var(--radius);
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <!-- باقي الكود السابق يبقى كما هو -->
  <!-- سأضيف فقط الأجزاء الجديدة -->

<script>
// دالة تشغيل الكود المطورة
function runCode() {
  const code = document.getElementById("code").value;
  const language = document.getElementById("language").value;
  const output = document.getElementById("output");
  
  output.classList.remove("error", "success");
  output.innerHTML = "";

  try {
    switch(language) {
      case "js":
        runJavaScript(code, output);
        break;
      case "html":
        runHTML(code, output);
        break;
      case "css":
        runCSS(code, output);
        break;
      case "python":
        runPython(code, output);
        break;
      default:
        output.textContent = "⚠️ Language not supported";
    }
  } catch (e) {
    output.innerHTML = `<div class="error">❌ Error: ${e.message}</div>`;
  }
}

// تشغيل JavaScript بشكل آمن
function runJavaScript(code, output) {
  const originalLog = console.log;
  const originalError = console.error;
  let logOutput = "";
  
  console.log = function(...args) {
    logOutput += args.map(arg => 
      typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
    ).join(' ') + '\n';
  };
  
  console.error = function(...args) {
    logOutput += '❌ ERROR: ' + args.join(' ') + '\n';
  };

  try {
    // استخدام Function constructor بدلاً من eval للأمان
    const safeEval = new Function(`
      "use strict";
      ${code}
    `);
    
    const result = safeEval();
    
    if (result !== undefined) {
      logOutput += `↳ Return: ${result}\n`;
    }
  } catch (e) {
    logOutput += `❌ Runtime Error: ${e.message}\n`;
  } finally {
    console.log = originalLog;
    console.error = originalError;
  }
  
  output.innerHTML = `<pre class="success">${logOutput || "✅ Code executed successfully"}</pre>`;
}

// تشغيل HTML في iframe
function runHTML(code, output) {
  // تنظيف أي iframe سابق
  const oldIframe = document.getElementById('html-preview');
  if (oldIframe) oldIframe.remove();
  
  // إنشاء iframe جديد
  const iframe = document.createElement('iframe');
  iframe.id = 'html-preview';
  iframe.className = 'preview-iframe';
  
  const previewContainer = document.createElement('div');
  previewContainer.className = 'preview-container';
  
  const header = document.createElement('div');
  header.className = 'preview-header';
  header.innerHTML = `
    <span><i class="fas fa-eye"></i> HTML Preview</span>
    <button onclick="this.closest('.preview-container').remove()" style="background:none;border:none;color:white;cursor:pointer;">
      <i class="fas fa-times"></i>
    </button>
  `;
  
  previewContainer.appendChild(header);
  previewContainer.appendChild(iframe);
  output.appendChild(previewContainer);
  
  // كتابة HTML في الـ iframe
  const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
  iframeDoc.open();
  iframeDoc.write(`
    <!DOCTYPE html>
    <html>
    <head>
      <style>
        body { 
          font-family: Arial, sans-serif; 
          padding: 20px;
          margin: 0;
        }
        .container { max-width: 100%; }
      </style>
    </head>
    <body>
      <div class="container">
        ${code}
      </div>
    </body>
    </html>
  `);
  iframeDoc.close();
}

// تشغيل CSS مع HTML تجريبي
function runCSS(code, output) {
  const oldIframe = document.getElementById('css-preview');
  if (oldIframe) oldIframe.remove();
  
  const iframe = document.createElement('iframe');
  iframe.id = 'css-preview';
  iframe.className = 'preview-iframe';
  
  const previewContainer = document.createElement('div');
  previewContainer.className = 'preview-container';
  
  const header = document.createElement('div');
  header.className = 'preview-header';
  header.innerHTML = `
    <span><i class="fas fa-palette"></i> CSS Preview</span>
    <div class="language-tabs">
      <span class="lang-tab active" onclick="switchCSSTab('basic', this)">Basic</span>
      <span class="lang-tab" onclick="switchCSSTab('advanced', this)">Advanced</span>
    </div>
  `;
  
  previewContainer.appendChild(header);
  previewContainer.appendChild(iframe);
  output.appendChild(previewContainer);
  
  updateCSSPreview('basic', code);
}

// تحديث معاينة CSS
function updateCSSPreview(type, cssCode) {
  const iframe = document.getElementById('css-preview');
  const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
  
  const htmlStructures = {
    basic: `
      <div class="header">Header</div>
      <div class="navigation">
        <a href="#">Home</a>
        <a href="#">About</a>
        <a href="#">Contact</a>
      </div>
      <div class="content">
        <h1>Welcome to CSS Preview</h1>
        <p>This is a paragraph with some text to demonstrate CSS styling.</p>
        <button class="btn">Click Me</button>
        <div class="card">
          <h3>Card Title</h3>
          <p>Card content goes here</p>
        </div>
      </div>
      <div class="footer">Footer &copy; 2024</div>
    `,
    advanced: `
      <div class="grid-container">
        <header class="header">Advanced Layout</header>
        <nav class="sidebar">
          <ul>
            <li><a href="#">Dashboard</a></li>
            <li><a href="#">Profile</a></li>
            <li><a href="#">Settings</a></li>
          </ul>
        </nav>
        <main class="main-content">
          <div class="card-grid">
            <div class="feature-card">
              <h3>Feature 1</h3>
              <p>Description of feature one</p>
            </div>
            <div class="feature-card">
              <h3>Feature 2</h3>
              <p>Description of feature two</p>
            </div>
            <div class="feature-card">
              <h3>Feature 3</h3>
              <p>Description of feature three</p>
            </div>
          </div>
        </main>
        <footer class="footer">Advanced Footer</footer>
      </div>
    `
  };
  
  iframeDoc.open();
  iframeDoc.write(`
    <!DOCTYPE html>
    <html>
    <head>
      <style>
        body { 
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          margin: 0;
          padding: 20px;
          background: #f5f5f5;
        }
        .container { 
          max-width: 100%;
          min-height: 100vh;
        }
        /* CSS الذي كتبه المستخدم */
        ${cssCode}
      </style>
    </head>
    <body>
      <div class="container">
        ${htmlStructures[type]}
      </div>
    </body>
    </html>
  `);
  iframeDoc.close();
}

// تبديل أنواع معاينة CSS
function switchCSSTab(type, element) {
  document.querySelectorAll('.lang-tab').forEach(tab => tab.classList.remove('active'));
  element.classList.add('active');
  
  const cssCode = document.getElementById("code").value;
  updateCSSPreview(type, cssCode);
}

// محاكاة Python باستخدام JavaScript
function runPython(code, output) {
  let pythonOutput = "";
  const lines = code.split('\n');
  
  // محاكاة بيئة Python بسيطة
  const pythonEnv = {
    print: (...args) => {
      pythonOutput += args.join(' ') + '\n';
    },
    range: (start, end, step) => {
      if (end === undefined) {
        end = start;
        start = 0;
      }
      step = step || 1;
      const result = [];
      for (let i = start; i < end; i += step) {
        result.push(i);
      }
      return result;
    },
    len: (obj) => obj.length,
    sum: (arr) => arr.reduce((a, b) => a + b, 0)
  };
  
  try {
    // تحويل كود Python المبسط إلى JavaScript
    const jsCode = convertSimplePythonToJS(code);
    
    // تنفيذ الكود في البيئة المحاكاة
    const executeInEnv = new Function('env', `
      with(env) {
        ${jsCode}
      }
    `);
    
    executeInEnv(pythonEnv);
    
    output.innerHTML = `
      <div class="python-output">
        <div style="margin-bottom: 10px;">
          <i class="fab fa-python"></i> Python Output (Simulated):
        </div>
        <pre>${pythonOutput || "✅ Code executed successfully (simulation)"}</pre>
      </div>
    `;
    
  } catch (e) {
    output.innerHTML = `<div class="error">❌ Python Simulation Error: ${e.message}</div>`;
  }
}

// تحويل Python مبسط إلى JavaScript
function convertSimplePythonToJS(pythonCode) {
  return pythonCode
    // التعليقات
    .replace(/#.*$/gm, '')
    // الطباعة
    .replace(/print\((.*)\)/g, 'env.print($1)')
    // الحلقات for
    .replace(/for (\w+) in range\((.*)\):/g, 'for (let $1 of env.range($2)) {')
    // الدوال البسيطة
    .replace(/def (\w+)\((.*)\):/g, 'function $1($2) {')
    // الشروط
    .replace(/if (.*):/g, 'if ($1) {')
    .replace(/elif (.*):/g, '} else if ($1) {')
    .replace(/else:/g, '} else {')
    // المسافات (تبسيط)
    .replace(/    /g, '  ')
    // نهاية الكتل
    .replace(/\n([^ {}\n])/g, '\n}\n$1')
    + '\n}';
}

// دالة محسنة لإنشاء الكود
function generateCode() {
  const desc = document.getElementById("description").value.toLowerCase();
  const language = document.getElementById("language").value;
  const codeArea = document.getElementById("code");

  let code = "";

  // أمثلة محسنة لكل لغة
  const templates = {
    js: `// JavaScript code generated from: "${desc}"
console.log("Hello from generated JavaScript!");

// Example interactive element
const button = document.createElement('button');
button.textContent = 'Dynamic Button';
button.style.cssText = \`
  padding: 10px 20px;
  margin: 10px;
  background: #4CAF50;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
\`;

button.onclick = () => {
  alert('Button clicked!');
  button.style.background = '#${Math.floor(Math.random()*16777215).toString(16)}';
};

document.body.appendChild(button);`,

    html: `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated HTML</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        .feature { 
            background: #e3f2fd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Welcome to Your Generated HTML</h1>
        <p>This page was automatically generated based on your description.</p>
        
        <div class="feature">
            <h3>Feature Section</h3>
            <p>You can modify this code as needed.</p>
            <button onclick="alert('HTML is working!')">Test Button</button>
        </div>
    </div>
</body>
</html>`,

    css: `/* Generated CSS from description */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #333;
}

.header {
    background: rgba(255, 255, 255, 0.9);
    padding: 2rem;
    text-align: center;
    backdrop-filter: blur(10px);
}

.navigation {
    display: flex;
    justify-content: center;
    gap: 2rem;
    padding: 1rem;
    background: rgba(0, 0, 0, 0.8);
}

.navigation a {
    color: white;
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 5px;
    transition: background 0.3s;
}

.navigation a:hover {
    background: rgba(255, 255, 255, 0.2);
}

.content {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 2rem;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.btn {
    background: #4CAF50;
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s;
}

.btn:hover {
    background: #45a049;
    transform: translateY(-2px);
}

.card {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid #4CAF50;
    margin: 1rem 0;
}

.footer {
    background: #2c3e50;
    color: white;
    text-align: center;
    padding: 2rem;
    margin-top: 2rem;
}`,

    python: `# Generated Python code from description
print("Welcome to Python Code Generation!")

def main():
    # Example function demonstrating basic Python features
    name = input("Enter your name: ")
    print(f"Hello, {name}!")
    
    # Demonstrate loops and conditionals
    numbers = [1, 2, 3, 4, 5]
    print("\\nNumber analysis:")
    
    for num in numbers:
        if num % 2 == 0:
            print(f"{num} is even")
        else:
            print(f"{num} is odd")
    
    # List comprehension example
    squares = [x**2 for x in numbers]
    print(f"\\nSquares: {squares}")
    
    # Dictionary example
    person = {
        "name": name,
        "age": 25,
        "city": "Pythonville"
    }
    
    print(f"\\nPerson data: {person}")

if __name__ == "__main__":
    main()`
  };

  code = templates[language] || `// Code generation for ${language} is not yet optimized`;
  codeArea.value = code;
  
  // إضافة للسجل
  addToHistory(desc, code, language);
}
</script>
</body>
</html>
