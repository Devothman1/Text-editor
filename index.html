<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-Powered Smart Educational Platform - Advanced</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
  <style>
    :root {
      --bg: #0f2027;
      --bg-light: #1e2b35;
      --text: #ffffff;
      --primary: #00bcd4;
      --primary-dark: #0097a7;
      --accent: #ff4081;
      --accent-dark: #f50057;
      --success: #4caf50;
      --warning: #ff9800;
      --info: #2196f3;
      --font: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      --radius: 8px;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 1rem;
      font-family: var(--font);
      background: linear-gradient(to right, var(--bg), #203a43, #2c5364);
      color: var(--text);
      max-width: 1200px;
      margin: auto;
      line-height: 1.6;
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      color: var(--primary);
      animation: glow 2s infinite alternate;
      margin-bottom: 1.5rem;
    }

    @keyframes glow {
      from { text-shadow: 0 0 10px var(--primary); }
      to { text-shadow: 0 0 30px var(--accent); }
    }

    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--bg-light);
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: var(--shadow);
      transition: transform 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
      color: var(--primary);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 0.5rem;
    }

    .card-header i {
      margin-right: 0.5rem;
      font-size: 1.2rem;
    }

    select, textarea, button, input {
      width: 100%;
      margin-top: 0.8rem;
      padding: 0.8rem;
      border-radius: var(--radius);
      border: none;
      font-size: 1rem;
      font-family: var(--font);
    }

    textarea {
      height: 150px;
      background: #1a1a2e;
      color: var(--text);
      font-family: 'Courier New', monospace;
      resize: vertical;
    }

    button {
      background: var(--primary);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-weight: 600;
    }

    button:hover {
      background: var(--accent);
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(0);
    }

    button.secondary {
      background: var(--bg);
      border: 1px solid var(--primary);
    }

    button.secondary:hover {
      background: var(--primary-dark);
    }

    .btn-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .ai-features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.8rem;
      margin-top: 1rem;
    }

    .ai-features button {
      font-size: 0.9rem;
      padding: 0.7rem;
    }

    pre {
      background: #111;
      padding: 1rem;
      margin-top: 1rem;
      border-radius: var(--radius);
      white-space: pre-wrap;
      color: #0f0;
      max-height: 300px;
      overflow-y: auto;
    }

    .error {
      color: var(--accent);
    }

    .success {
      color: var(--success);
    }

    .output-container {
      position: relative;
    }

    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .tabs {
      display: flex;
      background: rgba(0, 0, 0, 0.3);
      border-radius: var(--radius);
      padding: 0.3rem;
      margin-bottom: 1rem;
    }

    .tab {
      padding: 0.5rem 1rem;
      cursor: pointer;
      border-radius: calc(var(--radius) - 2px);
      transition: all 0.3s ease;
      text-align: center;
      flex: 1;
    }

    .tab.active {
      background: var(--primary);
    }

    .code-container {
      position: relative;
    }

    .code-actions {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      z-index: 10;
      display: flex;
      gap: 0.5rem;
    }

    .code-actions button {
      width: auto;
      margin: 0;
      padding: 0.4rem 0.8rem;
      background: rgba(0, 0, 0, 0.7);
      font-size: 0.8rem;
    }

    .loader {
      display: none;
      text-align: center;
      padding: 1rem;
    }

    .loader .spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 3px solid var(--primary);
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .api-key-container {
      display: flex;
      gap: 0.5rem;
    }

    .api-key-container input {
      flex: 1;
    }

    .api-key-container button {
      width: auto;
      margin: 0;
    }

    .feature-desc {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
      margin-top: 0.5rem;
    }

    .history-item {
      background: rgba(0, 0, 0, 0.2);
      padding: 0.8rem;
      border-radius: var(--radius);
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: all 0.3s ease;
      border-left: 3px solid var(--primary);
    }

    .history-item:hover {
      background: rgba(0, 0, 0, 0.4);
    }

    .history-title {
      font-weight: bold;
      margin-bottom: 0.3rem;
    }

    .history-preview {
      font-size: 0.8rem;
      opacity: 0.7;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* New Styles for Advanced Features */
    .preview-container {
      background: white;
      border-radius: var(--radius);
      margin-top: 1rem;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .preview-iframe {
      width: 100%;
      height: 400px;
      border: none;
      background: white;
    }

    .preview-header {
      background: var(--primary);
      color: white;
      padding: 0.5rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .language-tabs {
      display: flex;
      gap: 0.5rem;
    }

    .lang-tab {
      padding: 0.3rem 0.8rem;
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .lang-tab.active {
      background: white;
      color: var(--primary);
    }

    .python-output {
      background: #2b5b84;
      color: white;
      padding: 1rem;
      border-radius: var(--radius);
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
    }

    .ai-chat-container {
      background: var(--bg-light);
      border-radius: var(--radius);
      padding: 1rem;
      margin-top: 1rem;
      max-height: 300px;
      overflow-y: auto;
    }

    .chat-message {
      margin-bottom: 1rem;
      padding: 0.8rem;
      border-radius: var(--radius);
      max-width: 80%;
    }

    .user-message {
      background: var(--primary);
      margin-left: auto;
    }

    .ai-message {
      background: var(--bg);
      border: 1px solid var(--primary);
    }

    .chat-input-container {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .chat-input {
      flex: 1;
      padding: 0.8rem;
      border-radius: var(--radius);
      border: none;
      background: var(--bg);
      color: var(--text);
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .feature-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem;
      border-radius: var(--radius);
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }

    .feature-card:hover {
      transform: translateY(-3px);
      border-color: var(--primary);
      background: rgba(255, 255, 255, 0.08);
    }

    .feature-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: var(--primary);
    }

    .smart-suggestions {
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius);
      padding: 1rem;
      margin-top: 1rem;
    }

    .suggestion-item {
      padding: 0.5rem;
      margin: 0.3rem 0;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .suggestion-item:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .code-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .metric-card {
      background: rgba(255, 255, 255, 0.05);
      padding: 1rem;
      border-radius: var(--radius);
      text-align: center;
    }

    .metric-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--primary);
      margin: 0.5rem 0;
    }

    .learning-path {
      background: var(--bg-light);
      border-radius: var(--radius);
      padding: 1rem;
      margin-top: 1rem;
    }

    .path-step {
      display: flex;
      align-items: center;
      padding: 0.8rem;
      margin: 0.5rem 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius);
    }

    .step-number {
      background: var(--primary);
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      font-weight: bold;
    }

    .ai-insights {
      background: var(--bg-light);
      border-radius: var(--radius);
      padding: 1rem;
      margin-top: 1rem;
    }

    .insight-item {
      padding: 0.8rem;
      margin: 0.5rem 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius);
      border-left: 3px solid var(--info);
    }

    .code-compare {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    .compare-panel {
      background: var(--bg-light);
      border-radius: var(--radius);
      padding: 1rem;
    }

    .version-control {
      background: var(--bg-light);
      border-radius: var(--radius);
      padding: 1rem;
      margin-top: 1rem;
    }

    .version-item {
      padding: 0.8rem;
      margin: 0.5rem 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius);
      cursor: pointer;
    }

    .version-item.active {
      border-left: 3px solid var(--success);
    }
  </style>
</head>
<body>

  <h1>ü§ñ Connect Ai editor</h1>

  <div class="tabs">
    <div class="tab active" onclick="switchTab('code-generation')">Code Generation</div>
    <div class="tab" onclick="switchTab('code-execution')">Code Execution</div>
    <div class="tab" onclick="switchTab('ai-features')">AI Features</div>
    <div class="tab" onclick="switchTab('ai-chat')">AI Assistant</div>
    <div class="tab" onclick="switchTab('learning-path')">Learning Path</div>
    <div class="tab" onclick="switchTab('collaboration')">Collaboration</div>
    <div class="tab" onclick="switchTab('history')">History</div>
  </div>

  <div class="container">
    <!-- Code Generation Panel -->
    <div class="card tab-content" id="code-generation">
      <div class="card-header">
        <i class="fas fa-code"></i>
        <h2>Code Generation</h2>
      </div>
      
      <div class="api-key-container">
        <input type="password" id="api-key" placeholder="Enter OpenAI API Key (Optional)" />
        <button onclick="saveApiKey()" class="secondary">Save</button>
      </div>
      <div class="feature-desc">Without an API key, the platform will use simplified models</div>
      
      <select id="language">
        <option value="js">JavaScript</option>
        <option value="html">HTML</option>
        <option value="css">CSS</option>
        <option value="python">Python</option>
      </select>

      <textarea id="description" placeholder="Write a detailed description of the code you want to generate (example: a button that changes the background color when clicked, with a transition effect)..."></textarea>
      
      <div class="btn-group">
        <button onclick="generateCode()">
          <i class="fas fa-magic"></i> Generate Code
        </button>
        <button onclick="generateWithAI()" class="secondary">
          <i class="fas fa-robot"></i> Generate with AI
        </button>
      </div>

      <div class="loader" id="generation-loader">
        <div class="spinner"></div>
        <p>Generating code...</p>
      </div>
    </div>

    <!-- Code Display Panel -->
    <div class="card tab-content" id="code-execution">
      <div class="card-header">
        <i class="fas fa-play-circle"></i>
        <h2>Code Execution</h2>
      </div>
      
      <div class="code-container">
        <div class="code-actions">
          <button onclick="copyCode()" title="Copy Code">
            <i class="far fa-copy"></i>
          </button>
          <button onclick="formatCode()" title="Format Code">
            <i class="fas fa-indent"></i>
          </button>
          <button onclick="clearCode()" title="Clear Code">
            <i class="far fa-trash-alt"></i>
          </button>
        </div>
        <textarea id="code" placeholder="Generated code will appear here..."></textarea>
      </div>
      
      <div class="btn-group">
        <button onclick="runCode()">
          <i class="fas fa-play"></i> Run Code
        </button>
        <button onclick="debugCode()" class="secondary">
          <i class="fas fa-bug"></i> Debug Code
        </button>
      </div>
    </div>
  </div>

  <!-- AI Features Panel -->
  <div class="card tab-content" id="ai-features" style="display: none;">
    <div class="card-header">
      <i class="fas fa-robot"></i>
      <h2>Advanced AI Features</h2>
    </div>
    
    <div class="feature-grid">
      <div class="feature-card" onclick="explainCode()">
        <div class="feature-icon"><i class="fas fa-info-circle"></i></div>
        <div class="feature-title">Explain Code</div>
        <div class="feature-desc">Get detailed explanations</div>
      </div>
      
      <div class="feature-card" onclick="refactorCode()">
        <div class="feature-icon"><i class="fas fa-sync-alt"></i></div>
        <div class="feature-title">Refactor Code</div>
        <div class="feature-desc">Improve code structure</div>
      </div>
      
      <div class="feature-card" onclick="optimizeCode()">
        <div class="feature-icon"><i class="fas fa-tachometer-alt"></i></div>
        <div class="feature-title">Optimize Code</div>
        <div class="feature-desc">Performance improvements</div>
      </div>
      
      <div class="feature-card" onclick="addComments()">
        <div class="feature-icon"><i class="far fa-comment-dots"></i></div>
        <div class="feature-title">Add Comments</div>
        <div class="feature-desc">Documentation generation</div>
      </div>
      
      <div class="feature-card" onclick="translateCode()">
        <div class="feature-icon"><i class="fas fa-language"></i></div>
        <div class="feature-title">Translate Code</div>
        <div class="feature-desc">Between languages</div>
      </div>
      
      <div class="feature-card" onclick="suggestImprovements()">
        <div class="feature-icon"><i class="fas fa-lightbulb"></i></div>
        <div class="feature-title">Suggest Improvements</div>
        <div class="feature-desc">AI recommendations</div>
      </div>
      
      <!-- New AI Features -->
      <div class="feature-card" onclick="codeReview()">
        <div class="feature-icon"><i class="fas fa-search"></i></div>
        <div class="feature-title">Code Review</div>
        <div class="feature-desc">Comprehensive analysis</div>
      </div>
      
      <div class="feature-card" onclick="generateTests()">
        <div class="feature-icon"><i class="fas fa-vial"></i></div>
        <div class="feature-title">Generate Tests</div>
        <div class="feature-desc">Unit test creation</div>
      </div>
      
      <div class="feature-card" onclick="detectPatterns()">
        <div class="feature-icon"><i class="fas fa-project-diagram"></i></div>
        <div class="feature-title">Detect Patterns</div>
        <div class="feature-desc">Identify code patterns</div>
      </div>
      
      <div class="feature-card" onclick="securityScan()">
        <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
        <div class="feature-title">Security Scan</div>
        <div class="feature-desc">Vulnerability detection</div>
      </div>
      
      <div class="feature-card" onclick="performanceAnalysis()">
        <div class="feature-icon"><i class="fas fa-chart-line"></i></div>
        <div class="feature-title">Performance Analysis</div>
        <div class="feature-desc">Runtime optimization</div>
      </div>
      
      <div class="feature-card" onclick="codeVisualization()">
        <div class="feature-icon"><i class="fas fa-code-branch"></i></div>
        <div class="feature-title">Code Visualization</div>
        <div class="feature-desc">Structure diagrams</div>
      </div>
    </div>
    
    <div class="code-metrics">
      <div class="metric-card">
        <div>Code Quality</div>
        <div class="metric-value">87%</div>
        <div>Based on best practices</div>
      </div>
      <div class="metric-card">
        <div>Complexity</div>
        <div class="metric-value">Medium</div>
        <div>Cyclomatic analysis</div>
      </div>
      <div class="metric-card">
        <div>Maintainability</div>
        <div class="metric-value">92%</div>
        <div>Ease of maintenance</div>
      </div>
      <div class="metric-card">
        <div>Performance</div>
        <div class="metric-value">Good</div>
        <div>Runtime efficiency</div>
      </div>
    </div>
    
    <div class="loader" id="ai-loader">
      <div class="spinner"></div>
      <p>Processing...</p>
    </div>
    
    <div class="output-header">
      <h3>AI Results:</h3>
    </div>
    <pre id="ai-output">üí° AI results will appear here...</pre>
  </div>

  <!-- AI Chat Assistant Panel -->
  <div class="card tab-content" id="ai-chat" style="display: none;">
    <div class="card-header">
      <i class="fas fa-robot"></i>
      <h2>AI Programming Assistant</h2>
    </div>
    
    <div class="ai-chat-container" id="chat-messages">
      <div class="chat-message ai-message">
        <strong>AI Assistant:</strong> Hello! I'm your AI programming assistant. I can help explain concepts, debug code, suggest improvements, and answer any programming questions you have!
      </div>
    </div>
    
    <div class="chat-input-container">
      <input type="text" class="chat-input" id="chat-input" placeholder="Ask me anything about programming..." />
      <button onclick="sendChatMessage()" class="btn-primary">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
    
    <div class="smart-suggestions">
      <h4>Quick Questions:</h4>
      <div class="suggestion-item" onclick="askSuggestion('How do I fix this error?')">How do I fix this error?</div>
      <div class="suggestion-item" onclick="askSuggestion('Explain this code')">Explain this code</div>
      <div class="suggestion-item" onclick="askSuggestion('Optimize this function')">Optimize this function</div>
      <div class="suggestion-item" onclick="askSuggestion('Show me an example')">Show me an example</div>
    </div>
  </div>

  <!-- Learning Path Panel -->
  <div class="card tab-content" id="learning-path" style="display: none;">
    <div class="card-header">
      <i class="fas fa-graduation-cap"></i>
      <h2>Personalized Learning Path</h2>
    </div>
    
    <div class="learning-path">
      <h4>Your Learning Journey:</h4>
      <div class="path-step">
        <div class="step-number">1</div>
        <div>
          <strong>Basic Syntax</strong>
          <div style="font-size: 0.9rem; opacity: 0.8;">Completed ‚úì</div>
        </div>
      </div>
      <div class="path-step">
        <div class="step-number">2</div>
        <div>
          <strong>Functions & Variables</strong>
          <div style="font-size: 0.9rem; opacity: 0.8;">Completed ‚úì</div>
        </div>
      </div>
      <div class="path-step">
        <div class="step-number">3</div>
        <div>
          <strong>Control Structures</strong>
          <div style="font-size: 0.9rem; opacity: 0.8;">In Progress (80%)</div>
        </div>
      </div>
      <div class="path-step">
        <div class="step-number">4</div>
        <div>
          <strong>Object-Oriented Programming</strong>
          <div style="font-size: 0.9rem; opacity: 0.8;">Next Step</div>
        </div>
      </div>
      <div class="path-step">
        <div class="step-number">5</div>
        <div>
          <strong>Advanced Algorithms</strong>
          <div style="font-size: 0.9rem; opacity: 0.8;">Locked</div>
        </div>
      </div>
    </div>
    
    <div class="ai-insights">
      <h4>AI Learning Insights:</h4>
      <div class="insight-item">
        <strong>üìä Pattern Detected:</strong> You're improving quickly with loop structures!
      </div>
      <div class="insight-item">
        <strong>üí° Recommendation:</strong> Practice with array methods to strengthen your skills.
      </div>
      <div class="insight-item">
        <strong>üéØ Focus Area:</strong> Pay attention to error handling in your functions.
      </div>
    </div>
  </div>

  <!-- Collaboration Panel -->
  <div class="card tab-content" id="collaboration" style="display: none;">
    <div class="card-header">
      <i class="fas fa-users"></i>
      <h2>Collaborative Coding</h2>
    </div>
    
    <div class="code-compare">
      <div class="compare-panel">
        <h4>Original Code</h4>
        <textarea style="height: 200px; background: #1a1a2e; color: white; width: 100%;" id="original-code">function example() {
  console.log("Hello World");
}</textarea>
      </div>
      <div class="compare-panel">
        <h4>AI Improved Code</h4>
        <textarea style="height: 200px; background: #1a1a2e; color: white; width: 100%;" id="improved-code">/**
 * Example function with improved documentation
 * @returns {void}
 */
function example() {
  // Use strict mode for better error handling
  'use strict';
  
  // More descriptive logging
  console.log("Hello World - Application initialized");
  
  // Return for consistency
  return;
}</textarea>
      </div>
    </div>
    
    <div class="version-control">
      <h4>Code Version History</h4>
      <div class="version-item active">
        <strong>Version 3.1</strong> - AI optimized with documentation
      </div>
      <div class="version-item">
        <strong>Version 3.0</strong> - Added error handling
      </div>
      <div class="version-item">
        <strong>Version 2.0</strong> - Refactored structure
      </div>
      <div class="version-item">
        <strong>Version 1.0</strong> - Initial implementation
      </div>
    </div>
    
    <button onclick="startLiveSession()" class="btn-primary" style="margin-top: 1rem; width: 100%;">
      <i class="fas fa-broadcast-tower"></i> Start Live Collaboration Session
    </button>
  </div>

  <!-- History Panel -->
  <div class="card tab-content" id="history" style="display: none;">
    <div class="card-header">
      <i class="fas fa-history"></i>
      <h2>Code History</h2>
    </div>
    <button onclick="clearHistory()" class="secondary" style="width: auto; margin-bottom: 1rem;">
      <i class="fas fa-trash"></i> Clear History
    </button>
    <div id="history-list">
      <!-- History items will be dynamically added here -->
    </div>
  </div>

  <!-- Output Panel -->
  <div class="card output-container">
    <div class="output-header">
      <h3>Output:</h3>
      <button onclick="clearOutput()" style="width: auto;">
        <i class="fas fa-broom"></i> Clear Output
      </button>
    </div>
    <pre id="output">üí° Output will appear here...</pre>
  </div>

  <script>
    // Initialize the platform
    document.addEventListener('DOMContentLoaded', function() {
      // Load saved API key
      const savedApiKey = localStorage.getItem('openai-api-key');
      if (savedApiKey) {
        document.getElementById('api-key').value = savedApiKey;
      }
      
      // Load code history
      loadHistory();
    });

    // Tab switching function
    function switchTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
      });
      
      // Remove active class from all tabs
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Show selected tab content and set active class
      document.getElementById(tabName).style.display = 'block';
      event.target.classList.add('active');
    }

    // Save API key to localStorage
    function saveApiKey() {
      const apiKey = document.getElementById('api-key').value;
      if (apiKey) {
        localStorage.setItem('openai-api-key', apiKey);
        showTemporaryMessage(document.getElementById('api-key'), 'API key saved successfully', 'success');
      } else {
        localStorage.removeItem('openai-api-key');
        showTemporaryMessage(document.getElementById('api-key'), 'API key removed', 'success');
      }
    }

    // Basic code generation function
    function generateCode() {
      const desc = document.getElementById("description").value.toLowerCase();
      const language = document.getElementById("language").value;
      const codeArea = document.getElementById("code");

      let code = "";

      if (language === "js") {
        if (desc.includes("button") && desc.includes("color")) {
          code = `// Create a button to change background color
const button = document.createElement("button");
button.textContent = "Change Color";
button.style.padding = "10px 20px";
button.style.margin = "10px";
button.style.backgroundColor = "#4CAF50";
button.style.color = "white";
button.style.border = "none";
button.style.borderRadius = "5px";
button.style.cursor = "pointer";

// Add hover effect
button.addEventListener("mouseenter", function() {
  button.style.transform = "scale(1.05)";
  button.style.transition = "transform 0.2s";
});

button.addEventListener("mouseleave", function() {
  button.style.transform = "scale(1)";
});

// Change background color on click
button.addEventListener("click", function() {
  const randomColor = "#" + Math.floor(Math.random()*16777215).toString(16);
  document.body.style.transition = "background-color 0.5s ease";
  document.body.style.backgroundColor = randomColor;
});

document.body.appendChild(button);`;
        } else if (desc.includes("time") || desc.includes("clock")) {
          code = `// Display real-time clock
function updateTime() {
  const now = new Date();
  const timeString = now.toLocaleTimeString();
  
  // Create time display element if it doesn't exist
  let timeDisplay = document.getElementById('time-display');
  if (!timeDisplay) {
    timeDisplay = document.createElement('div');
    timeDisplay.id = 'time-display';
    timeDisplay.style.fontSize = '2rem';
    timeDisplay.style.fontWeight = 'bold';
    timeDisplay.style.textAlign = 'center';
    timeDisplay.style.margin = '20px';
    timeDisplay.style.padding = '20px';
    timeDisplay.style.backgroundColor = 'rgba(0, 0, 0, 0.3)';
    timeDisplay.style.borderRadius = '10px';
    document.body.appendChild(timeDisplay);
  }
  
  timeDisplay.textContent = timeString;
}

// Update time every second
setInterval(updateTime, 1000);
updateTime(); // Initial call`;
        } else if (desc.includes("welcome") || desc.includes("greeting")) {
          code = `// Create an interactive welcome message
const welcomeModal = document.createElement('div');
welcomeModal.style.position = 'fixed';
welcomeModal.style.top = '0';
welcomeModal.style.left = '0';
welcomeModal.style.width = '100%';
welcomeModal.style.height = '100%';
welcomeModal.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
welcomeModal.style.display = 'flex';
welcomeModal.style.justifyContent = 'center';
welcomeModal.style.alignItems = 'center';
welcomeModal.style.zIndex = '1000';

const modalContent = document.createElement('div');
modalContent.style.backgroundColor = 'var(--bg-light)';
modalContent.style.padding = '2rem';
modalContent.style.borderRadius = '10px';
modalContent.style.textAlign = 'center';
modalContent.style.maxWidth = '400px';

const welcomeText = document.createElement('h2');
welcomeText.textContent = 'Welcome to our Educational Platform!';
welcomeText.style.color = 'var(--primary)';
welcomeText.style.marginBottom = '1rem';

const closeButton = document.createElement('button');
closeButton.textContent = 'Start Learning';
closeButton.style.padding = '10px 20px';
closeButton.style.backgroundColor = 'var(--accent)';
closeButton.style.color = 'white';
closeButton.style.border = 'none';
closeButton.style.borderRadius = '5px';
closeButton.style.cursor = 'pointer';

closeButton.addEventListener('click', function() {
  document.body.removeChild(welcomeModal);
});

modalContent.appendChild(welcomeText);
modalContent.appendChild(closeButton);
welcomeModal.appendChild(modalContent);
document.body.appendChild(welcomeModal);`;
        } else {
          code = `// ü§ñ I didn't fully understand your description
// Try to be more specific in describing the code you want to create

// Examples:
// - "A button that changes background color"
// - "Display real-time clock"
// - "Interactive welcome message"

console.log("Input description: ${desc}");
alert("ü§ñ I didn't fully understand your description. Please try to be more specific.");`;
        }
      } else if (language === "html") {
        code = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated HTML</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hello World!</h1>
        <p>This is a basic HTML page.</p>
    </div>
</body>
</html>`;
      } else if (language === "css") {
        code = `/* Basic CSS styles */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #333;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
}

.card:hover {
    transform: translateY(-5px);
}

.button {
    display: inline-block;
    padding: 10px 20px;
    background-color: #4CAF50;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    transition: background-color 0.3s;
}

.button:hover {
    background-color: #45a049;
}

@media (max-width: 768px) {
    .container {
        padding: 10px;
    }
    
    .card {
        padding: 15px;
    }
}`;
      } else if (language === "python") {
        code = `# Generated Python code from description
print("Welcome to Python Code Generation!")

def main():
    # Example function demonstrating basic Python features
    name = "User"
    print(f"Hello, {name}!")
    
    # Demonstrate loops and conditionals
    numbers = [1, 2, 3, 4, 5]
    print("\\nNumber analysis:")
    
    for num in numbers:
        if num % 2 == 0:
            print(f"{num} is even")
        else:
            print(f"{num} is odd")
    
    # List comprehension example
    squares = [x**2 for x in numbers]
    print(f"\\nSquares: {squares}")
    
    # Dictionary example
    person = {
        "name": name,
        "age": 25,
        "city": "Pythonville"
    }
    
    print(f"\\nPerson data: {person}")

if __name__ == "__main__":
    main()`;
      }

      codeArea.value = code;
      addToHistory(desc, code, language);
    }

    // Advanced AI code generation
    async function generateWithAI() {
      const desc = document.getElementById("description").value;
      const language = document.getElementById("language").value;
      const apiKey = localStorage.getItem('openai-api-key');
      
      if (!desc.trim()) {
        showOutput("‚ö†Ô∏è Please enter a code description first", "error");
        return;
      }
      
      const loader = document.getElementById("generation-loader");
      loader.style.display = "block";
      
      try {
        let generatedCode;
        
        if (apiKey) {
          // Use OpenAI API for code generation
          generatedCode = await generateWithOpenAI(desc, language, apiKey);
        } else {
          // Use enhanced local generation as fallback
          generatedCode = generateEnhancedCode(desc, language);
        }
        
        document.getElementById("code").value = generatedCode;
        addToHistory(desc, generatedCode, language);
        showOutput("‚úÖ Code generated successfully using AI", "success");
      } catch (error) {
        console.error("AI generation error:", error);
        showOutput("‚ùå Error generating code: " + error.message, "error");
        
        // Fallback to basic generation
        generateCode();
      } finally {
        loader.style.display = "none";
      }
    }

    // Enhanced local code generation
    function generateEnhancedCode(desc, language) {
      const enhancedTemplates = {
        js: {
          "button": `// Advanced button with effects
const button = document.createElement('button');
button.textContent = 'Interactive Button';
button.className = 'ai-enhanced-button';

// Add advanced styles
Object.assign(button.style, {
  padding: '12px 24px',
  margin: '10px',
  backgroundColor: '#4CAF50',
  color: 'white',
  border: 'none',
  borderRadius: '8px',
  cursor: 'pointer',
  fontSize: '16px',
  fontWeight: 'bold',
  transition: 'all 0.3s ease',
  boxShadow: '0 4px 8px rgba(0,0,0,0.2)'
});

// Interactive effects
button.addEventListener('mouseenter', function() {
  this.style.transform = 'translateY(-2px)';
  this.style.boxShadow = '0 6px 12px rgba(0,0,0,0.3)';
});

button.addEventListener('mouseleave', function() {
  this.style.transform = 'translateY(0)';
  this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
});

button.addEventListener('click', function() {
  // Click effect
  this.style.transform = 'scale(0.95)';
  setTimeout(() => {
    this.style.transform = 'scale(1)';
  }, 150);
  
  // Change color
  this.style.backgroundColor = '#' + Math.floor(Math.random()*16777215).toString(16);
});

document.body.appendChild(button);`,
          "form": `// Advanced input form
const form = document.createElement('form');
form.style.cssText = 'max-width: 400px; margin: 20px auto; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;';

// Name field
const nameLabel = document.createElement('label');
nameLabel.textContent = 'Name:';
nameLabel.style.display = 'block';
nameLabel.style.marginBottom = '5px';

const nameInput = document.createElement('input');
nameInput.type = 'text';
nameInput.required = true;
nameInput.style.cssText = 'width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px;';

// Email field
const emailLabel = document.createElement('label');
emailLabel.textContent = 'Email:';
emailLabel.style.display = 'block';
emailLabel.style.marginBottom = '5px';

const emailInput = document.createElement('input');
emailInput.type = 'email';
emailInput.required = true;
emailInput.style.cssText = 'width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px;';

// Submit button
const submitButton = document.createElement('button');
submitButton.type = 'submit';
submitButton.textContent = 'Submit';
submitButton.style.cssText = 'width: 100%; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;';

// Form submission handling
form.addEventListener('submit', function(e) {
  e.preventDefault();
  alert('Form submitted successfully!');
  form.reset();
});

form.appendChild(nameLabel);
form.appendChild(nameInput);
form.appendChild(emailLabel);
form.appendChild(emailInput);
form.appendChild(submitButton);
document.body.appendChild(form);`
        }
      };
      
      // Find the best matching template
      for (const [keyword, template] of Object.entries(enhancedTemplates[language] || {})) {
        if (desc.includes(keyword)) {
          return template;
        }
      }
      
      // Default enhanced template
      return `// ü§ñ Advanced ${language} code
// This code was generated based on your description: "${desc}"

console.log("Smart Learning Platform - Advanced Version");

// You can modify this code according to your needs
// For more help, use the available AI features

// Basic code to get started:
function initializeApp() {
    console.log("App is ready!");
}

initializeApp();`;
    }

    // Run code with enhanced safety
    function runCode() {
      const code = document.getElementById("code").value;
      const language = document.getElementById("language").value;
      const output = document.getElementById("output");
      
      output.classList.remove("error", "success");
      output.innerHTML = "";

      try {
        switch(language) {
          case "js":
            runJavaScript(code, output);
            break;
          case "html":
            runHTML(code, output);
            break;
          case "css":
            runCSS(code, output);
            break;
          case "python":
            runPython(code, output);
            break;
          default:
            output.textContent = "‚ö†Ô∏è Language not supported";
        }
      } catch (e) {
        output.innerHTML = `<div class="error">‚ùå Error: ${e.message}</div>`;
      }
    }

    // Run JavaScript
    function runJavaScript(code, output) {
      const originalLog = console.log;
      const originalError = console.error;
      let logOutput = "";
      
      console.log = function(...args) {
        logOutput += args.map(arg => 
          typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
        ).join(' ') + '\n';
      };
      
      console.error = function(...args) {
        logOutput += '‚ùå ERROR: ' + args.join(' ') + '\n';
      };

      try {
        const safeEval = new Function(`
          "use strict";
          ${code}
        `);
        
        const result = safeEval();
        
        if (result !== undefined) {
          logOutput += `‚Ü≥ Return: ${result}\n`;
        }
      } catch (e) {
        logOutput += `‚ùå Runtime Error: ${e.message}\n`;
      } finally {
        console.log = originalLog;
        console.error = originalError;
      }
      
      output.innerHTML = `<pre class="success">${logOutput || "‚úÖ Code executed successfully"}</pre>`;
    }

    // Run HTML in iframe
    function runHTML(code, output) {
      const oldIframe = document.getElementById('html-preview');
      if (oldIframe) oldIframe.remove();
      
      const iframe = document.createElement('iframe');
      iframe.id = 'html-preview';
      iframe.className = 'preview-iframe';
      
      const previewContainer = document.createElement('div');
      previewContainer.className = 'preview-container';
      
      const header = document.createElement('div');
      header.className = 'preview-header';
      header.innerHTML = `
        <span><i class="fas fa-eye"></i> HTML Preview</span>
        <button onclick="this.closest('.preview-container').remove()" style="background:none;border:none;color:white;cursor:pointer;">
          <i class="fas fa-times"></i>
        </button>
      `;
      
      previewContainer.appendChild(header);
      previewContainer.appendChild(iframe);
      output.appendChild(previewContainer);
      
      const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
      iframeDoc.open();
      iframeDoc.write(code.includes('<!DOCTYPE') ? code : `
        <!DOCTYPE html>
        <html>
        <head>
          <style>
            body { 
              font-family: Arial, sans-serif; 
              padding: 20px;
              margin: 0;
            }
            .container { max-width: 100%; }
          </style>
        </head>
        <body>
          <div class="container">
            ${code}
          </div>
        </body>
        </html>
      `);
      iframeDoc.close();
    }

    // Run CSS with HTML template
    function runCSS(code, output) {
      const oldIframe = document.getElementById('css-preview');
      if (oldIframe) oldIframe.remove();
      
      const iframe = document.createElement('iframe');
      iframe.id = 'css-preview';
      iframe.className = 'preview-iframe';
      
      const previewContainer = document.createElement('div');
      previewContainer.className = 'preview-container';
      
      const header = document.createElement('div');
      header.className = 'preview-header';
      header.innerHTML = `
        <span><i class="fas fa-palette"></i> CSS Preview</span>
        <div class="language-tabs">
          <span class="lang-tab active" onclick="switchCSSTab('basic', this)">Basic</span>
          <span class="lang-tab" onclick="switchCSSTab('advanced', this)">Advanced</span>
        </div>
      `;
      
      previewContainer.appendChild(header);
      previewContainer.appendChild(iframe);
      output.appendChild(previewContainer);
      
      updateCSSPreview('basic', code);
    }

    // Update CSS preview
    function updateCSSPreview(type, cssCode) {
      const iframe = document.getElementById('css-preview');
      const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
      
      const htmlStructures = {
        basic: `
          <div class="header">Header</div>
          <div class="navigation">
            <a href="#">Home</a>
            <a href="#">About</a>
            <a href="#">Contact</a>
          </div>
          <div class="content">
            <h1>Welcome to CSS Preview</h1>
            <p>This is a paragraph with some text to demonstrate CSS styling.</p>
            <button class="btn">Click Me</button>
            <div class="card">
              <h3>Card Title</h3>
              <p>Card content goes here</p>
            </div>
          </div>
          <div class="footer">Footer &copy; 2024</div>
        `,
        advanced: `
          <div class="grid-container">
            <header class="header">Advanced Layout</header>
            <nav class="sidebar">
              <ul>
                <li><a href="#">Dashboard</a></li>
                <li><a href="#">Profile</a></li>
                <li><a href="#">Settings</a></li>
              </ul>
            </nav>
            <main class="main-content">
              <div class="card-grid">
                <div class="feature-card">
                  <h3>Feature 1</h3>
                  <p>Description of feature one</p>
                </div>
                <div class="feature-card">
                  <h3>Feature 2</h3>
                  <p>Description of feature two</p>
                </div>
                <div class="feature-card">
                  <h3>Feature 3</h3>
                  <p>Description of feature three</p>
                </div>
              </div>
            </main>
            <footer class="footer">Advanced Footer</footer>
          </div>
        `
      };
      
      iframeDoc.open();
      iframeDoc.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <style>
            body { 
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              margin: 0;
              padding: 20px;
              background: #f5f5f5;
            }
            .container { 
              max-width: 100%;
              min-height: 100vh;
            }
            ${cssCode}
          </style>
        </head>
        <body>
          <div class="container">
            ${htmlStructures[type]}
          </div>
        </body>
        </html>
      `);
      iframeDoc.close();
    }

    // Switch CSS tabs
    function switchCSSTab(type, element) {
      document.querySelectorAll('.lang-tab').forEach(tab => tab.classList.remove('active'));
      element.classList.add('active');
      
      const cssCode = document.getElementById("code").value;
      updateCSSPreview(type, cssCode);
    }

    // Simulate Python execution
    function runPython(code, output) {
      let pythonOutput = "";
      
      // Simple Python simulation
      const pythonEnv = {
        print: (...args) => {
          pythonOutput += args.join(' ') + '\n';
        }
      };
      
      try {
        // Convert basic Python to JS
        const jsCode = code
          .replace(/print\((.*)\)/g, 'env.print($1)')
          .replace(/#.*$/gm, '');
        
        const executeInEnv = new Function('env', jsCode);
        executeInEnv(pythonEnv);
        
        output.innerHTML = `
          <div class="python-output">
            <div style="margin-bottom: 10px;">
              <i class="fab fa-python"></i> Python Output (Simulated):
            </div>
            <pre>${pythonOutput || "‚úÖ Code executed successfully (simulation)"}</pre>
          </div>
        `;
      } catch (e) {
        output.innerHTML = `<div class="error">‚ùå Python Simulation Error: ${e.message}</div>`;
      }
    }

    // AI Features Implementation
    async function explainCode() {
      const code = document.getElementById("code").value;
      if (!code.trim()) {
        showAIOutput("‚ö†Ô∏è Please enter code first", "error");
        return;
      }
      
      showAILoader(true);
      
      setTimeout(() => {
        const explanation = `Code Explanation:

üìù This code does the following:
‚Ä¢ Creates dynamic HTML elements using JavaScript
‚Ä¢ Adds event handlers for user interaction
‚Ä¢ Applies dynamic CSS styles to change appearance
‚Ä¢ Uses functions like setInterval for automatic updates

üîç Important points:
- The code starts by creating new DOM elements
- Properties and styles are added to each element
- There are event handlers for events like click and mouseenter
- Updates happen asynchronously

üí° Suggestions:
1. You could add error handling
2. Separate styles into a dedicated CSS file
3. Use classes instead of inline styles`;
        
        showAIOutput(explanation, "success");
        showAILoader(false);
      }, 1500);
    }

    async function refactorCode() {
      const code = document.getElementById("code").value;
      if (!code.trim()) {
        showAIOutput("‚ö†Ô∏è Please enter code first", "error");
        return;
      }
      
      showAILoader(true);
      
      setTimeout(() => {
        const refactoredCode = `// Code after refactoring and improvement

// Helper function to create elements
function createElement(tag, properties = {}, styles = {}) {
    const element = document.createElement(tag);
    
    // Set properties
    Object.keys(properties).forEach(key => {
        element[key] = properties[key];
    });
    
    // Set styles
    Object.keys(styles).forEach(key => {
        element.style[key] = styles[key];
    });
    
    return element;
}

// Helper function to add event listeners
function addEventListeners(element, events) {
    Object.keys(events).forEach(event => {
        element.addEventListener(event, events[event]);
    });
}

// Main code after refactoring
function initializeApp() {
    // Create button using helper functions
    const button = createElement(
        'button',
        { textContent: 'Enhanced Button' },
        {
            padding: '12px 24px',
            margin: '10px',
            backgroundColor: '#4CAF50',
            color: 'white',
            border: 'none',
            borderRadius: '8px',
            cursor: 'pointer',
            transition: 'all 0.3s ease'
        }
    );
    
    // Add event listeners
    addEventListeners(button, {
        mouseenter: function() {
            this.style.transform = 'scale(1.05)';
        },
        mouseleave: function() {
            this.style.transform = 'scale(1)';
        },
        click: function() {
            this.style.backgroundColor = '#' + Math.floor(Math.random()*16777215).toString(16);
        }
    });
    
    document.body.appendChild(button);
}

// Initialize the application
document.addEventListener('DOMContentLoaded', initializeApp);`;
        
        document.getElementById("code").value = refactoredCode;
        showAIOutput("‚úÖ Code refactored successfully. Improved:\n‚Ä¢ Added helper functions\n‚Ä¢ Separated responsibilities\n‚Ä¢ Improved readability\n‚Ä¢ Reduced repetition", "success");
        showAILoader(false);
      }, 2000);
    }

    // Additional AI features
    async function optimizeCode() {
      showAILoader(true);
      setTimeout(() => {
        showAIOutput("‚úÖ Optimizations suggested:\n\n1. Reduce DOM queries\n2. Use event delegation\n3. Cache elements in variables\n4. Reduce style repetition\n5. Use requestAnimationFrame for animations", "success");
        showAILoader(false);
      }, 1500);
    }

    async function addComments() {
      const code = document.getElementById("code").value;
      showAILoader(true);
      setTimeout(() => {
        const commentedCode = `/**
 * Smart Educational Platform - Documented Code
 * This code was generated by the Smart Educational Platform
 * Date: ${new Date().toLocaleDateString()}
 */

// Main function to initialize the application
function initializeApplication() {
    // Initialization code here
    console.log("Application ready to run");
}

// Call the main function when the page loads
document.addEventListener('DOMContentLoaded', initializeApplication);`;
        
        document.getElementById("code").value = commentedCode + '\n\n' + code;
        showAIOutput("‚úÖ Added explanatory comments to the code", "success");
        showAILoader(false);
      }, 1500);
    }

    async function translateCode() {
      showAILoader(true);
      setTimeout(() => {
        showAIOutput("üî§ Code terminology translation:\n\n‚Ä¢ function ‚Üí ÿØÿßŸÑÿ©\n‚Ä¢ variable ‚Üí ŸÖÿ™ÿ∫Ÿäÿ±\n‚Ä¢ event ‚Üí ÿ≠ÿØÿ´\n‚Ä¢ element ‚Üí ÿπŸÜÿµÿ±\n‚Ä¢ style ‚Üí ŸÜŸÖÿ∑\n‚Ä¢ listener ‚Üí ŸÖÿ≥ÿ™ŸÖÿπ\n‚Ä¢ callback ‚Üí ÿ±ÿØ ÿßŸÑÿßÿ™ÿµÿßŸÑ\n‚Ä¢ array ‚Üí ŸÖÿµŸÅŸàŸÅÿ©\n‚Ä¢ object ‚Üí ŸÉÿßÿ¶ŸÜ", "success");
        showAILoader(false);
      }, 1500);
    }

    async function suggestImprovements() {
      showAILoader(true);
      setTimeout(() => {
        showAIOutput("üí° Code improvement suggestions:\n\n1. Use latest ES6+ features\n2. Add error handling\n3. Improve application performance\n4. Enhance user experience\n5. Add proper documentation\n6. Test code under different conditions", "success");
        showAILoader(false);
      }, 1500);
    }

    async function debugCode() {
      const code = document.getElementById("code").value;
      showAILoader(true);
      
      setTimeout(() => {
        const issues = [];
        
        if (code.includes("innerHTML")) {
          issues.push("‚ö†Ô∏è Avoid using innerHTML for security reasons, use textContent or createElement instead");
        }
        
        if (code.includes("setInterval") && !code.includes("clearInterval")) {
          issues.push("‚ö†Ô∏è Make sure to use clearInterval to clean up timers");
        }
        
        if (code.includes("document.write")) {
          issues.push("‚ùå Avoid using document.write as it wipes page content");
        }
        
        if (code.includes("var ")) {
          issues.push("üí° Use let or const instead of var for better block scope");
        }
        
        if (issues.length === 0) {
          issues.push("‚úÖ No obvious errors in the code. The code looks good!");
        }
        
        showAIOutput("üîç Code inspection results:\n\n" + issues.join('\n\n'), issues.some(i => i.includes('‚ùå')) ? "error" : "success");
        showAILoader(false);
      }, 1500);
    }

    // NEW ADVANCED AI FEATURES
    function codeReview() {
      showAILoader(true);
      setTimeout(() => {
        const code = document.getElementById("code").value;
        const review = `üîç CODE REVIEW RESULTS:

üìä CODE QUALITY: 85/100
‚úÖ STRENGTHS:
‚Ä¢ Good variable naming conventions
‚Ä¢ Proper indentation and formatting
‚Ä¢ Logical code structure

‚ö†Ô∏è AREAS FOR IMPROVEMENT:
${getImprovementSuggestions(code)}

üéØ RECOMMENDATIONS:
1. Add error handling for edge cases
2. Consider using more descriptive function names
3. Add input validation where needed
4. Include code comments for complex logic

üí° BEST PRACTICES:
‚Ä¢ Use const for variables that won't be reassigned
‚Ä¢ Prefer template literals over string concatenation
‚Ä¢ Consider using modern ES6+ features`;
        
        showAIOutput(review, "success");
        showAILoader(false);
      }, 2000);
    }

    function generateTests() {
      showAILoader(true);
      setTimeout(() => {
        const code = document.getElementById("code").value;
        const tests = `// Generated Unit Tests\n${code}\n\n// TEST SUITE\ndescribe('Code Functionality', () => {\n  test('should execute without errors', () => {\n    expect(() => {\n      // Your code execution\n    }).not.toThrow();\n  });\n\n  test('should return expected results', () => {\n    expect(true).toBe(true);\n  });\n});`;
        
        document.getElementById("code").value = tests;
        showAIOutput("‚úÖ Unit tests generated successfully! Added to code editor.", "success");
        showAILoader(false);
      }, 2000);
    }

    function detectPatterns() {
      showAILoader(true);
      setTimeout(() => {
        const code = document.getElementById("code").value;
        const patterns = `üîç CODE PATTERN ANALYSIS:

üìà DETECTED PATTERNS:
‚Ä¢ ${code.includes('function') ? 'Function declarations' : 'Procedural code'}
‚Ä¢ ${code.includes('class') ? 'Object-oriented patterns' : 'Functional patterns'}
‚Ä¢ ${code.includes('=>') ? 'Arrow function usage' : 'Traditional function usage'}
‚Ä¢ ${code.includes('const') || code.includes('let') ? 'Modern variable declarations' : 'Traditional variable declarations'}

üé® ARCHITECTURAL INSIGHTS:
${getArchitecturalInsights(code)}

üîÑ COMMON PATTERNS IDENTIFIED:
${getCommonPatterns(code)}`;
        
        showAIOutput(patterns, "success");
        showAILoader(false);
      }, 1500);
    }

    function securityScan() {
      showAILoader(true);
      setTimeout(() => {
        const code = document.getElementById("code").value;
        const issues = [];
        
        if (code.includes("eval(")) issues.push("‚ùå eval() usage - security risk");
        if (code.includes("innerHTML") && !code.includes("textContent")) issues.push("‚ö†Ô∏è innerHTML usage - potential XSS vulnerability");
        if (code.includes("localStorage") && code.includes("password")) issues.push("‚ùå Storing passwords in localStorage - insecure");
        
        if (issues.length === 0) {
          showAIOutput("‚úÖ SECURITY SCAN PASSED: No critical security issues detected", "success");
        } else {
          showAIOutput(`üîí SECURITY SCAN RESULTS:\n\n${issues.join('\n')}\n\nüí° RECOMMENDATIONS:\n‚Ä¢ Avoid eval() and innerHTML with user input\n‚Ä¢ Use HTTPS for all requests\n‚Ä¢ Never store sensitive data in localStorage`, "error");
        }
        showAILoader(false);
      }, 2000);
    }

    function performanceAnalysis() {
      showAILoader(true);
      setTimeout(() => {
        const code = document.getElementById("code").value;
        const analysis = `üìä PERFORMANCE ANALYSIS:

‚ö° PERFORMANCE SCORE: 78/100

‚úÖ OPTIMIZATIONS DETECTED:
‚Ä¢ Efficient DOM query caching
‚Ä¢ Proper event listener management

‚ö†Ô∏è PERFORMANCE BOTTLENECKS:
${getPerformanceBottlenecks(code)}

üéØ OPTIMIZATION SUGGESTIONS:
1. Minimize DOM manipulations in loops
2. Use event delegation for multiple elements
3. Consider lazy loading for heavy operations
4. Implement debouncing for frequent events`;
        
        showAIOutput(analysis, "success");
        showAILoader(false);
      }, 1800);
    }

    function codeVisualization() {
      showAILoader(true);
      setTimeout(() => {
        const code = document.getElementById("code").value;
        const visualization = `üìä CODE STRUCTURE VISUALIZATION:

üèóÔ∏è  ARCHITECTURE OVERVIEW:
[Main Function] ‚Üí [Helper Functions] ‚Üí [DOM Operations]

üîó DEPENDENCY GRAPH:
${getDependencyGraph(code)}

üìù CODE METRICS:
‚Ä¢ Lines of code: ${code.split('\n').length}
‚Ä¢ Functions: ${(code.match(/function/g) || []).length}
‚Ä¢ Variables: ${(code.match(/(const|let|var)\s+\w+/g) || []).length}
‚Ä¢ Complexity: ${getComplexityLevel(code)}`;
        
        showAIOutput(visualization, "success");
        showAILoader(false);
      }, 2500);
    }

    // AI Chat Assistant Functions
    function sendChatMessage() {
      const input = document.getElementById('chat-input');
      const message = input.value.trim();
      
      if (!message) return;
      
      addChatMessage(message, 'user');
      input.value = '';
      
      const typingIndicator = addChatMessage('AI is thinking...', 'ai');
      
      setTimeout(() => {
        typingIndicator.remove();
        const response = generateAIResponse(message);
        addChatMessage(response, 'ai');
      }, 1500);
    }

    function addChatMessage(message, sender) {
      const container = document.getElementById('chat-messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `chat-message ${sender}-message`;
      
      if (sender === 'user') {
        messageDiv.innerHTML = `<strong>You:</strong> ${message}`;
      } else {
        messageDiv.innerHTML = `<strong>AI Assistant:</strong> ${message}`;
      }
      
      container.appendChild(messageDiv);
      container.scrollTop = container.scrollHeight;
      
      return messageDiv;
    }

    function askSuggestion(question) {
      document.getElementById('chat-input').value = question;
      sendChatMessage();
    }

    function generateAIResponse(message) {
      const lowerMessage = message.toLowerCase();
      const code = document.getElementById("code").value;
      
      if (lowerMessage.includes('error') || lowerMessage.includes('fix')) {
        return `I can help you fix that error. Based on your code, I notice ${getCodeIssues(code)}. Try ${getFixSuggestions(code)}`;
      } else if (lowerMessage.includes('explain') || lowerMessage.includes('what does')) {
        return `This code appears to ${getCodeExplanation(code)}. The main purpose is ${getCodePurpose(code)}`;
      } else if (lowerMessage.includes('optimize') || lowerMessage.includes('improve')) {
        return `Here's how to optimize your code: ${getOptimizationTips(code)}`;
      } else if (lowerMessage.includes('example') || lowerMessage.includes('show me')) {
        return `Here's an example:\n\n${getCodeExample(lowerMessage)}`;
      } else {
        return `I understand you're asking about "${message}". As an AI programming assistant, I can help you with code explanations, debugging, optimization, and learning guidance. Could you provide more details about what you'd like to know?`;
      }
    }

    // Collaboration Features
    function startLiveSession() {
      showOutput("üîÑ Starting live collaboration session... AI Assistant joined.", "success");
      setTimeout(() => {
        showOutput("‚úÖ Live session active! You can now collaborate in real-time with AI suggestions.", "success");
      }, 1000);
    }

    // Helper functions
    function getImprovementSuggestions(code) {
      const suggestions = [];
      if (!code.includes("try") && !code.includes("catch")) suggestions.push("‚Ä¢ Add error handling with try/catch");
      if (code.includes("==") && !code.includes("===")) suggestions.push("‚Ä¢ Use strict equality (===) instead of loose equality (==)");
      if (code.match(/var\s+\w+/)) suggestions.push("‚Ä¢ Replace var with let/const for better scoping");
      
      return suggestions.length > 0 ? suggestions.join('\n') : "‚Ä¢ No major improvements needed";
    }

    function getArchitecturalInsights(code) {
      if (code.includes("class ")) return "‚Ä¢ Object-oriented architecture detected\n‚Ä¢ Good encapsulation practices";
      if (code.includes("function") && code.includes("=>")) return "‚Ä¢ Functional programming patterns\n‚Ä¢ Modern JavaScript practices";
      return "‚Ä¢ Procedural code structure\n‚Ä¢ Consider modularizing with functions";
    }

    function getCommonPatterns(code) {
      const patterns = [];
      if (code.includes("addEventListener")) patterns.push("‚Ä¢ Event-driven architecture");
      if (code.includes("fetch") || code.includes("axios")) patterns.push("‚Ä¢ API integration pattern");
      if (code.includes("Promise") || code.includes("async")) patterns.push("‚Ä¢ Asynchronous programming");
      if (code.includes("document.")) patterns.push("‚Ä¢ DOM manipulation pattern");
      
      return patterns.length > 0 ? patterns.join('\n') : "‚Ä¢ Basic programming patterns";
    }

    function getPerformanceBottlenecks(code) {
      const bottlenecks = [];
      if (code.match(/document\..*\(.*\)/g)?.length > 5) bottlenecks.push("‚Ä¢ Multiple DOM queries - consider caching");
      if (code.includes("setInterval")) bottlenecks.push("‚Ä¢ Continuous intervals - ensure proper cleanup");
      
      return bottlenecks.length > 0 ? bottlenecks.join('\n') : "‚Ä¢ No significant bottlenecks detected";
    }

    function getDependencyGraph(code) {
      if (code.includes("function")) return "‚îî‚îÄ‚îÄ Main\n    ‚îú‚îÄ‚îÄ Helper Functions\n    ‚îî‚îÄ‚îÄ Event Handlers";
      return "‚îî‚îÄ‚îÄ Linear execution flow";
    }

    function getComplexityLevel(code) {
      const lines = code.split('\n').length;
      const functions = (code.match(/function/g) || []).length;
      
      if (lines < 20 && functions < 3) return "Low";
      if (lines < 50 && functions < 5) return "Medium";
      return "High";
    }

    function getCodeIssues(code) {
      const issues = [];
      if (code.includes("eval(")) issues.push("potential security issues with eval()");
      if (code.includes("innerHTML")) issues.push("XSS vulnerabilities with innerHTML");
      if (code.match(/for\s*\(.*;.*;.*\)/)) issues.push("possible performance issues with loops");
      
      return issues.length > 0 ? issues.join(", ") : "no major issues detected";
    }

    function getFixSuggestions(code) {
      if (code.includes("eval(")) return "using JSON.parse() or Function constructor instead of eval()";
      if (code.includes("innerHTML")) return "using textContent or createElement instead of innerHTML";
      return "reviewing the error message and checking variable names";
    }

    function getCodeExplanation(code) {
      if (code.includes("document.createElement")) return "create dynamic HTML elements";
      if (code.includes("addEventListener")) return "handle user interactions";
      if (code.includes("fetch") || code.includes("XMLHttpRequest")) return "make HTTP requests";
      return "perform operations based on your implementation";
    }

    function getCodePurpose(code) {
      if (code.includes("button") && code.includes("click")) return "handle user button clicks";
      if (code.includes("localStorage")) return "store data in the browser";
      if (code.includes("setInterval") || code.includes("setTimeout")) return "execute code after delays or repeatedly";
      return "implement the functionality you described";
    }

    function getOptimizationTips(code) {
      const tips = [];
      if (code.includes("document.getElementById") && code.includes("for")) tips.push("cache DOM elements outside loops");
      if (code.includes("innerHTML") && code.includes("text")) tips.push("use textContent instead of innerHTML for better performance");
      if (!code.includes("use strict")) tips.push("add 'use strict' for better error checking");
      
      return tips.length > 0 ? tips.join(", ") : "your code is already well-optimized!";
    }

    function getCodeExample(query) {
      if (query.includes("array")) return `// Array manipulation example\nconst numbers = [1, 2, 3, 4, 5];\nconst doubled = numbers.map(n => n * 2);\nconst even = numbers.filter(n => n % 2 === 0);\nconsole.log(doubled); // [2, 4, 6, 8, 10]`;
      if (query.includes("function")) return `// Function example\nfunction calculateArea(width, height) {\n  return width * height;\n}\nconst area = calculateArea(5, 10);\nconsole.log(area); // 50`;
      return `// Basic example\nconsole.log("Hello, World!");\nconst name = "AI Assistant";\nconsole.log(\`Hello, \${name}!\`);`;
    }

    // Utility functions
    function showOutput(message, type) {
      const output = document.getElementById("output");
      output.textContent = message;
      output.className = type;
    }

    function showAIOutput(message, type) {
      const output = document.getElementById("ai-output");
      output.textContent = message;
      output.className = type;
    }

    function showAILoader(show) {
      document.getElementById("ai-loader").style.display = show ? "block" : "none";
    }

    function copyCode() {
      const codeArea = document.getElementById("code");
      codeArea.select();
      document.execCommand("copy");
      showTemporaryMessage(codeArea, "Code copied to clipboard", "success");
    }

    function formatCode() {
      const codeArea = document.getElementById("code");
      const formatted = codeArea.value
        .replace(/{/g, ' {\n')
        .replace(/}/g, '\n}\n')
        .replace(/;/g, ';\n')
        .replace(/\n\n+/g, '\n\n');
      
      codeArea.value = formatted;
      showTemporaryMessage(codeArea, "Code formatted", "success");
    }

    function clearCode() {
      document.getElementById("code").value = "";
      showOutput("Code cleared", "success");
    }

    function clearOutput() {
      document.getElementById("output").textContent = "üí° Output will appear here...";
      document.getElementById("output").className = "";
    }

    function showTemporaryMessage(element, message, type) {
      const originalBorder = element.style.border;
      element.style.border = type === "success" ? "2px solid #4CAF50" : "2px solid #ff4081";
      
      setTimeout(() => {
        element.style.border = originalBorder;
      }, 2000);
    }

    // History management
    function addToHistory(description, code, language) {
      const history = JSON.parse(localStorage.getItem('code-history') || '[]');
      
      history.unshift({
        id: Date.now(),
        description,
        code,
        language,
        timestamp: new Date().toLocaleString(),
        preview: code.substring(0, 100) + '...'
      });
      
      if (history.length > 10) {
        history.pop();
      }
      
      localStorage.setItem('code-history', JSON.stringify(history));
      loadHistory();
    }

    function loadHistory() {
      const history = JSON.parse(localStorage.getItem('code-history') || '[]');
      const historyList = document.getElementById('history-list');
      
      historyList.innerHTML = '';
      
      if (history.length === 0) {
        historyList.innerHTML = '<p style="text-align: center; opacity: 0.7;">No items in history</p>';
        return;
      }
      
      history.forEach(item => {
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
          <div class="history-title">${item.description}</div>
          <div class="history-preview">${item.preview}</div>
          <div style="font-size: 0.7rem; opacity: 0.6; margin-top: 0.3rem;">${item.timestamp} - ${item.language}</div>
        `;
        
        historyItem.addEventListener('click', () => {
          document.getElementById('code').value = item.code;
          document.getElementById('language').value = item.language;
          showOutput(`Loaded code from history (${item.timestamp})`, "success");
          switchTab('code-execution');
        });
        
        historyList.appendChild(historyItem);
      });
    }

    function clearHistory() {
      if (confirm('Are you sure you want to clear code history?')) {
        localStorage.removeItem('code-history');
        loadHistory();
        showOutput("History cleared", "success");
      }
    }

    // OpenAI API integration (simplified)
    async function generateWithOpenAI(description, language, apiKey) {
      await new Promise(resolve => setTimeout(resolve, 2000));
      return generateEnhancedCode(description, language);
    }
  </script>
</body>
</html>
